{"version":3,"file":"atlas-v2.min.js","sources":["../state/StateManager.js","../commands/CommandBus.js","../utils.js","../geometry/Area.js","../geometry/GeoPoint.js","../geometry/PixelPoint.js","../viewport/ViewportManager.js","../surfaces/SurfaceManager.js","../geometry/GeoLine.js","../geometry/GeoPolygon.js","../rendering/RenderPipeline.js","../projection/Mercator.js","../projection/Transformation.js","../projection/EPSG3857.js","../interaction/InteractionManager.js","../interaction/Behavior.js","../interaction/DragPan.js","../interaction/ScrollWheelZoom.js","../widgets/WidgetSystem.js","../widgets/Widget.js","../widgets/ZoomWidget.js","../engine/AtlasEngine.js","../surfaces/Surface.js","../features/Feature.js","../surfaces/TileSurface.js","../surfaces/VectorSurface.js"],"sourcesContent":["class StateManager {\n  constructor() {\n    this.state = {};\n    this.listeners = {};\n  }\n\n  set(key, value) {\n    this.state[key] = value;\n    if (this.listeners[key]) {\n      this.listeners[key].forEach(listener => listener(value));\n    }\n  }\n\n  get(key) {\n    return this.state[key];\n  }\n\n  watch(key, listener) {\n    if (!this.listeners[key]) {\n      this.listeners[key] = [];\n    }\n    this.listeners[key].push(listener);\n  }\n\n  unwatch(key, listener) {\n    if (this.listeners[key]) {\n      this.listeners[key] = this.listeners[key].filter(l => l !== listener);\n    }\n  }\n}\n\nexport default StateManager;","class CommandBus {\n  constructor() {\n    this.handlers = {};\n  }\n\n  register(commandName, handler) {\n    this.handlers[commandName] = handler;\n  }\n\n  execute(commandName, payload) {\n    const handler = this.handlers[commandName];\n    if (handler) {\n      return handler(payload);\n    }\n    throw new Error(`No handler registered for command: ${commandName}`);\n  }\n}\n\nexport default CommandBus;","export function formatNum(num, precision) {\n  if (precision === false) { return num; }\n  var pow = Math.pow(10, precision === undefined ? 6 : precision);\n  return Math.round(num * pow) / pow;\n}\n\nexport var isArray = Array.isArray || function (obj) {\n  return (Object.prototype.toString.call(obj) === '[object Array]');\n};\n\nfunction toPixelPoints(points, projection, zoom, pixelOrigin) {\n  return points.map(p => projection.projectToPixel(p, zoom).subtract(pixelOrigin));\n}\n\nexport class LineUtil {\n  static clip(points, bounds) {\n    // For now, we'll just return the original points.\n    // In a real implementation, this would clip the line to the bounds.\n    return points;\n  }\n}\n\nexport class PolygonUtil {\n  static clip(points, bounds) {\n    // For now, we'll just return the original points.\n    // In a real implementation, this would clip the polygon to the bounds.\n    return points;\n  }\n}","import GeoPoint, { toGeoPoint } from './GeoPoint.js';\n\nclass Area {\n  constructor(corner1, corner2) {\n    if (corner1) {\n      const points = corner2 ? [corner1, corner2] : corner1;\n      for (const point of points) {\n        this.extend(point);\n      }\n    }\n  }\n\n  extend(obj) {\n    let sw2, ne2;\n\n    if (obj instanceof GeoPoint) {\n      sw2 = obj;\n      ne2 = obj;\n    } else if (obj instanceof Area) {\n      sw2 = obj._southWest;\n      ne2 = obj._northEast;\n      if (!sw2 || !ne2) { return this; }\n    } else {\n      obj = toGeoPoint(obj) || toArea(obj);\n      return this.extend(obj);\n    }\n\n    if (!this._southWest && !this._northEast) {\n      this._southWest = new GeoPoint(sw2.lat, sw2.lng);\n      this._northEast = new GeoPoint(ne2.lat, ne2.lng);\n    } else {\n      this._southWest.lat = Math.min(sw2.lat, this._southWest.lat);\n      this._southWest.lng = Math.min(sw2.lng, this._southWest.lng);\n      this._northEast.lat = Math.max(ne2.lat, this._northEast.lat);\n      this._northEast.lng = Math.max(ne2.lng, this._northEast.lng);\n    }\n    return this;\n  }\n\n  pad(bufferRatio) {\n    const sw = this._southWest;\n    const ne = this._northEast;\n    const heightBuffer = Math.abs(sw.lat - ne.lat) * bufferRatio;\n    const widthBuffer = Math.abs(sw.lng - ne.lng) * bufferRatio;\n\n    return new Area(\n      new GeoPoint(sw.lat - heightBuffer, sw.lng - widthBuffer),\n      new GeoPoint(ne.lat + heightBuffer, ne.lng + widthBuffer)\n    );\n  }\n\n  getCenter() {\n    return new GeoPoint(\n      (this._southWest.lat + this._northEast.lat) / 2,\n      (this._southWest.lng + this._northEast.lng) / 2\n    );\n  }\n\n  getSouthWest() {\n    return this._southWest;\n  }\n\n  getNorthEast() {\n    return this._northEast;\n  }\n\n  getNorthWest() {\n    return new GeoPoint(this.getNorth(), this.getWest());\n  }\n\n  getSouthEast() {\n    return new GeoPoint(this.getSouth(), this.getEast());\n  }\n\n  getWest() {\n    return this._southWest.lng;\n  }\n\n  getSouth() {\n    return this._southWest.lat;\n  }\n\n  getEast() {\n    return this._northEast.lng;\n  }\n\n  getNorth() {\n    return this._northEast.lat;\n  }\n\n  contains(obj) {\n    obj = (typeof obj[0] === 'number' || obj instanceof GeoPoint || 'lat' in obj)\n      ? toGeoPoint(obj)\n      : toArea(obj);\n\n    const sw = this._southWest;\n    const ne = this._northEast;\n    let sw2, ne2;\n\n    if (obj instanceof Area) {\n      sw2 = obj.getSouthWest();\n      ne2 = obj.getNorthEast();\n    } else {\n      sw2 = ne2 = obj;\n    }\n\n    return (sw2.lat >= sw.lat) && (ne2.lat <= ne.lat) &&\n           (sw2.lng >= sw.lng) && (ne2.lng <= ne.lng);\n  }\n\n  intersects(otherArea) {\n    otherArea = toArea(otherArea);\n    const sw = this._southWest;\n    const ne = this._northEast;\n    const sw2 = otherArea.getSouthWest();\n    const ne2 = otherArea.getNorthEast();\n\n    const latIntersects = (ne2.lat >= sw.lat) && (sw2.lat <= ne.lat);\n    const lngIntersects = (ne2.lng >= sw.lng) && (sw2.lng <= ne.lng);\n\n    return latIntersects && lngIntersects;\n  }\n\n  toBBoxString() {\n    return [this.getWest(), this.getSouth(), this.getEast(), this.getNorth()].join(',');\n  }\n\n  equals(otherArea, maxMargin) {\n    if (!otherArea) { return false; }\n    otherArea = toArea(otherArea);\n    return this._southWest.equals(otherArea.getSouthWest(), maxMargin) &&\n           this._northEast.equals(otherArea.getNorthEast(), maxMargin);\n  }\n\n  isValid() {\n    return !!(this._southWest && this._northEast);\n  }\n}\n\nexport function toArea(a, b) {\n  if (a instanceof Area) {\n    return a;\n  }\n  return new Area(a, b);\n}\n\nexport default Area;","import { formatNum, isArray } from '../utils.js';\nimport { toArea } from './Area.js';\n\nconst R = 6371000; // Earth radius in meters\n\nclass GeoPoint {\n  constructor(lat, lng, alt) {\n    if (isNaN(lat) || isNaN(lng)) {\n      throw new Error(`Invalid GeoPoint object: (${lat}, ${lng})`);\n    }\n    this.lat = +lat;\n    this.lng = +lng;\n\n    if (alt !== undefined) {\n      this.alt = +alt;\n    }\n  }\n\n  equals(other, maxMargin = 1.0E-9) {\n    if (!other) { return false; }\n    other = toGeoPoint(other);\n\n    const margin = Math.max(\n      Math.abs(this.lat - other.lat),\n      Math.abs(this.lng - other.lng)\n    );\n\n    return margin <= maxMargin;\n  }\n\n  toString(precision) {\n    return `GeoPoint(${formatNum(this.lat, precision)}, ${formatNum(this.lng, precision)})`;\n  }\n\n  distanceTo(other) {\n    other = toGeoPoint(other);\n    const rad = Math.PI / 180;\n    const lat1 = this.lat * rad;\n    const lat2 = other.lat * rad;\n    const sinDLat = Math.sin((other.lat - this.lat) * rad / 2);\n    const sinDLon = Math.sin((other.lng - this.lng) * rad / 2);\n    const a = sinDLat * sinDLat + Math.cos(lat1) * Math.cos(lat2) * sinDLon * sinDLon;\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    return R * c;\n  }\n\n  // wrap() will be implemented later with the ProjectionSystem\n\n  toArea(sizeInMeters) {\n    const latAccuracy = 180 * sizeInMeters / 40075017;\n    const lngAccuracy = latAccuracy / Math.cos((Math.PI / 180) * this.lat);\n\n    return toArea(\n      [this.lat - latAccuracy, this.lng - lngAccuracy],\n      [this.lat + latAccuracy, this.lng + lngAccuracy]\n    );\n  }\n\n  clone() {\n    return new GeoPoint(this.lat, this.lng, this.alt);\n  }\n}\n\nexport function toGeoPoint(a, b, c) {\n  if (a instanceof GeoPoint) {\n    return a;\n  }\n  if (isArray(a) && typeof a[0] !== 'object') {\n    if (a.length === 3) {\n      return new GeoPoint(a[0], a[1], a[2]);\n    }\n    if (a.length === 2) {\n      return new GeoPoint(a[0], a[1]);\n    }\n    return null;\n  }\n  if (a === undefined || a === null) {\n    return a;\n  }\n  if (typeof a === 'object' && 'lat' in a) {\n    return new GeoPoint(a.lat, 'lng' in a ? a.lng : a.lon, a.alt);\n  }\n  if (b === undefined) {\n    return null;\n  }\n  return new GeoPoint(a, b, c);\n}\n\nexport default GeoPoint;","import { formatNum, isArray } from '../utils.js';\n\nconst trunc = Math.trunc || function (v) {\n  return v > 0 ? Math.floor(v) : Math.ceil(v);\n};\n\nclass PixelPoint {\n  constructor(x, y, round) {\n    this.x = (round ? Math.round(x) : x);\n    this.y = (round ? Math.round(y) : y);\n  }\n\n  clone() {\n    return new PixelPoint(this.x, this.y);\n  }\n\n  add(point) {\n    const newPoint = this.clone();\n    newPoint.x += point.x;\n    newPoint.y += point.y;\n    return newPoint;\n  }\n\n  subtract(point) {\n    const newPoint = this.clone();\n    newPoint.x -= point.x;\n    newPoint.y -= point.y;\n    return newPoint;\n  }\n\n  divideBy(num) {\n    const newPoint = this.clone();\n    newPoint.x /= num;\n    newPoint.y /= num;\n    return newPoint;\n  }\n\n  multiplyBy(num) {\n    const newPoint = this.clone();\n    newPoint.x *= num;\n    newPoint.y *= num;\n    return newPoint;\n  }\n\n  scaleBy(point) {\n    return new PixelPoint(this.x * point.x, this.y * point.y);\n  }\n\n  unscaleBy(point) {\n    return new PixelPoint(this.x / point.x, this.y / point.y);\n  }\n\n  round() {\n    const newPoint = this.clone();\n    newPoint.x = Math.round(newPoint.x);\n    newPoint.y = Math.round(newPoint.y);\n    return newPoint;\n  }\n\n  floor() {\n    const newPoint = this.clone();\n    newPoint.x = Math.floor(newPoint.x);\n    newPoint.y = Math.floor(newPoint.y);\n    return newPoint;\n  }\n\n  ceil() {\n    const newPoint = this.clone();\n    newPoint.x = Math.ceil(newPoint.x);\n    newPoint.y = Math.ceil(newPoint.y);\n    return newPoint;\n  }\n\n  trunc() {\n    const newPoint = this.clone();\n    newPoint.x = trunc(newPoint.x);\n    newPoint.y = trunc(newPoint.y);\n    return newPoint;\n  }\n\n  distanceTo(point) {\n    const x = point.x - this.x;\n    const y = point.y - this.y;\n    return Math.sqrt(x * x + y * y);\n  }\n\n  equals(point) {\n    return point.x === this.x && point.y === this.y;\n  }\n\n  contains(point) {\n    return Math.abs(point.x) <= Math.abs(this.x) &&\n           Math.abs(point.y) <= Math.abs(this.y);\n  }\n\n  toString() {\n    return `PixelPoint(${formatNum(this.x)}, ${formatNum(this.y)})`;\n  }\n}\n\nexport function toPixelPoint(x, y, round) {\n  if (x instanceof PixelPoint) {\n    return x;\n  }\n  if (isArray(x)) {\n    return new PixelPoint(x[0], x[1]);\n  }\n  if (x === undefined || x === null) {\n    return x;\n  }\n  if (typeof x === 'object' && 'x' in x && 'y' in x) {\n    return new PixelPoint(x.x, x.y);\n  }\n  return new PixelPoint(x, y, round);\n}\n\nexport default PixelPoint;","import { toGeoPoint } from '../geometry/GeoPoint.js';\nimport PixelPoint from '../geometry/PixelPoint.js';\nimport Area from '../geometry/Area.js';\n\nclass ViewportManager {\n  constructor(engine, options = {}) {\n    this.engine = engine;\n    this.stateManager = engine.stateManager;\n\n    // Initialize viewport state\n    this.stateManager.set('viewport.center', options.center || [0, 0]);\n    this.stateManager.set('viewport.zoom', options.zoom || 1);\n  }\n\n  navigateTo({ center, zoom }) {\n    // This will eventually contain the logic to smoothly pan and zoom the map.\n    // For now, it just updates the state.\n    if (center) {\n      this.stateManager.set('viewport.center', center);\n    }\n    if (zoom) {\n      this.stateManager.set('viewport.zoom', zoom);\n    }\n  }\n\n  zoomIn(delta = 1) {\n    const currentZoom = this.stateManager.get('viewport.zoom');\n    this.navigateTo({ zoom: currentZoom + delta });\n  }\n\n  zoomOut(delta = 1) {\n    const currentZoom = this.stateManager.get('viewport.zoom');\n    this.navigateTo({ zoom: currentZoom - delta });\n  }\n\n  panBy(offset) {\n    const center = this.stateManager.get('viewport.center');\n    const zoom = this.stateManager.get('viewport.zoom');\n    const projection = this.engine.projection;\n\n    const currentPixel = projection.projectToPixel(toGeoPoint(center), zoom);\n    const newPixel = currentPixel.add(new PixelPoint(offset.x, offset.y));\n    const newCenter = projection.unprojectFromPixel(newPixel, zoom);\n\n    this.navigateTo({ center: [newCenter.lat, newCenter.lng] });\n  }\n\n  getPixelOrigin() {\n    const center = this.stateManager.get('viewport.center');\n    const zoom = this.stateManager.get('viewport.zoom');\n    const projection = this.engine.projection;\n    const pixelPoint = projection.projectToPixel(toGeoPoint(center), zoom);\n    const viewHalf = this.getSize().divideBy(2);\n    return pixelPoint.subtract(viewHalf).round();\n  }\n\n  getSize() {\n    const container = this.engine.container;\n    return new PixelPoint(container.clientWidth, container.clientHeight);\n  }\n\n  getPixelBounds() {\n    const size = this.getSize();\n    return new Area([0, 0], [size.x, size.y]);\n  }\n}\n\nexport default ViewportManager;","class SurfaceManager {\n  constructor(engine) {\n    this.engine = engine;\n    this.surfaces = [];\n  }\n\n  mount(surface) {\n    this.surfaces.push(surface);\n    if (surface.onMount) {\n      surface.onMount();\n    }\n    this.engine.renderPipeline.render();\n  }\n\n  unmount(surface) {\n    const index = this.surfaces.indexOf(surface);\n    if (index > -1) {\n      if (surface.onUnmount) {\n        surface.onUnmount();\n      }\n      this.surfaces.splice(index, 1);\n      this.engine.renderPipeline.render();\n    }\n  }\n}\n\nexport default SurfaceManager;","class GeoLine {\n  constructor(points) {\n    this.points = points;\n  }\n}\n\nexport default GeoLine;","class GeoPolygon {\n  constructor(points) {\n    this.points = points;\n  }\n}\n\nexport default GeoPolygon;","import GeoPoint from '../geometry/GeoPoint.js';\nimport GeoLine from '../geometry/GeoLine.js';\nimport GeoPolygon from '../geometry/GeoPolygon.js';\nimport PixelPoint from '../geometry/PixelPoint.js';\nimport { LineUtil, PolygonUtil } from '../utils.js';\n\nclass RenderPipeline {\n  constructor(engine) {\n    this.engine = engine;\n    this.renderer = null; // This will hold the actual rendering engine (e.g., Canvas, WebGL)\n    this._initRenderer();\n  }\n\n  _initRenderer() {\n    // For now, we'll use a simple canvas renderer.\n    // This can be extended to support other rendering backends like WebGL.\n    const canvas = document.createElement('canvas');\n    this.engine.container.appendChild(canvas);\n    this.renderer = canvas.getContext('2d');\n\n    this.engine.stateManager.watch('viewport.resize', this._onResize.bind(this));\n    this._onResize(); // Initial resize\n  }\n\n  _onResize() {\n      const container = this.engine.container;\n      this.renderer.canvas.width = container.clientWidth;\n      this.renderer.canvas.height = container.clientHeight;\n      this.render();\n  }\n\n  render() {\n    // Clear the canvas\n    this.renderer.clearRect(0, 0, this.renderer.canvas.width, this.renderer.canvas.height);\n\n    // This is where we will loop through all the surfaces and render them.\n    const surfaces = this.engine.surfaces.surfaces;\n    for (const surface of surfaces) {\n      if (surface.render) {\n        surface.render(this.renderer);\n      }\n    }\n  }\n\n  draw(renderer, feature) {\n    const projection = this.engine.projection;\n    const zoom = this.engine.stateManager.get('viewport.zoom');\n    const pixelOrigin = this.engine.viewport.getPixelOrigin();\n    const bounds = this.engine.viewport.getPixelBounds();\n\n    renderer.strokeStyle = feature.style.color;\n    renderer.lineWidth = feature.style.weight;\n    renderer.fillStyle = feature.style.fillColor;\n    renderer.globalAlpha = feature.style.fillOpacity;\n\n    if (feature.geometry instanceof GeoPoint) {\n      this._drawPoint(renderer, feature.geometry, projection, zoom, pixelOrigin);\n    } else if (feature.geometry instanceof GeoLine) {\n      this._drawLine(renderer, feature.geometry, projection, zoom, pixelOrigin, bounds);\n    } else if (feature.geometry instanceof GeoPolygon) {\n      this._drawPolygon(renderer, feature.geometry, projection, zoom, pixelOrigin, bounds);\n    }\n  }\n\n  _toPixelPoints(points, projection, zoom, pixelOrigin) {\n    return points.map(p => projection.projectToPixel(p, zoom).subtract(pixelOrigin));\n  }\n\n  _drawPoint(renderer, geometry, projection, zoom, pixelOrigin) {\n    const pixelPoint = projection.projectToPixel(geometry, zoom).subtract(pixelOrigin);\n    renderer.beginPath();\n    renderer.arc(pixelPoint.x, pixelPoint.y, 5, 0, 2 * Math.PI);\n    renderer.fill();\n    renderer.stroke();\n  }\n\n  _drawLine(renderer, geometry, projection, zoom, pixelOrigin, bounds) {\n    const points = this._toPixelPoints(geometry.points, projection, zoom, pixelOrigin);\n    const clippedPoints = LineUtil.clip(points, bounds);\n\n    if (clippedPoints.length === 0) {\n      return;\n    }\n\n    renderer.beginPath();\n    for (let i = 0; i < clippedPoints.length; i++) {\n      const p = clippedPoints[i];\n      if (i === 0) {\n        renderer.moveTo(p.x, p.y);\n      } else {\n        renderer.lineTo(p.x, p.y);\n      }\n    }\n    renderer.stroke();\n  }\n\n  _drawPolygon(renderer, geometry, projection, zoom, pixelOrigin, bounds) {\n    const points = this._toPixelPoints(geometry.points, projection, zoom, pixelOrigin);\n    const clippedPoints = PolygonUtil.clip(points, bounds);\n\n    if (clippedPoints.length === 0) {\n      return;\n    }\n\n    renderer.beginPath();\n    for (let i = 0; i < clippedPoints.length; i++) {\n      const p = clippedPoints[i];\n      if (i === 0) {\n        renderer.moveTo(p.x, p.y);\n      } else {\n        renderer.lineTo(p.x, p.y);\n      }\n    }\n    renderer.closePath();\n    renderer.fill();\n    renderer.stroke();\n  }\n}\n\nexport default RenderPipeline;","import PixelPoint from '../geometry/PixelPoint.js';\nimport GeoPoint from '../geometry/GeoPoint.js';\nimport Area from '../geometry/Area.js';\n\nconst R = 6378137;\nconst MAX_LATITUDE = 85.0511287798;\n\nclass Mercator {\n  constructor() {\n    this.R = R;\n    this.MAX_LATITUDE = MAX_LATITUDE;\n    const d = R * Math.PI;\n    this.bounds = new Area([-d, -d], [d, d]);\n  }\n\n  project(geoPoint) {\n    const d = Math.PI / 180;\n    const max = this.MAX_LATITUDE;\n    const lat = Math.max(Math.min(max, geoPoint.lat), -max);\n    const sin = Math.sin(lat * d);\n\n    return new PixelPoint(\n      this.R * geoPoint.lng * d,\n      this.R * Math.log((1 + sin) / (1 - sin)) / 2\n    );\n  }\n\n  unproject(pixelPoint) {\n    const d = 180 / Math.PI;\n    return new GeoPoint(\n      (2 * Math.atan(Math.exp(pixelPoint.y / this.R)) - (Math.PI / 2)) * d,\n      pixelPoint.x * d / this.R\n    );\n  }\n}\n\nexport default Mercator;","import PixelPoint from '../geometry/PixelPoint.js';\n\nclass Transformation {\n  constructor(a, b, c, d) {\n    if (Array.isArray(a)) {\n      this._a = a[0];\n      this._b = a[1];\n      this._c = a[2];\n      this._d = a[3];\n      return;\n    }\n    this._a = a;\n    this._b = b;\n    this._c = c;\n    this._d = d;\n  }\n\n  transform(point, scale = 1) {\n    const newPoint = point.clone();\n    newPoint.x = scale * (this._a * newPoint.x + this._b);\n    newPoint.y = scale * (this._c * newPoint.y + this._d);\n    return newPoint;\n  }\n\n  untransform(point, scale = 1) {\n    return new PixelPoint(\n      (point.x / scale - this._b) / this._a,\n      (point.y / scale - this._d) / this._c\n    );\n  }\n}\n\nexport default Transformation;","import Mercator from './Mercator.js';\nimport Transformation from './Transformation.js';\n\nclass EPSG3857 {\n  constructor() {\n    this.code = 'EPSG:3857';\n    this.projection = new Mercator();\n\n    const scale = 0.5 / (Math.PI * this.projection.R);\n    this.transformation = new Transformation(scale, 0.5, -scale, 0.5);\n  }\n\n  project(geoPoint) {\n    return this.projection.project(geoPoint);\n  }\n\n  unproject(pixelPoint) {\n    return this.projection.unproject(pixelPoint);\n  }\n\n  projectToPixel(geoPoint, zoom) {\n    const projectedPoint = this.project(geoPoint);\n    const scale = this.scale(zoom);\n    return this.transformation.transform(projectedPoint, scale);\n  }\n\n  unprojectFromPixel(pixelPoint, zoom) {\n    const scale = this.scale(zoom);\n    const untransformedPoint = this.transformation.untransform(pixelPoint, scale);\n    return this.unproject(untransformedPoint);\n  }\n\n  // The following methods will be part of the ProjectionSystem\n  // and will be moved there later.\n  scale(zoom) {\n    return 256 * Math.pow(2, zoom);\n  }\n\n  zoom(scale) {\n    return Math.log(scale / 256) / Math.LN2;\n  }\n}\n\nexport default EPSG3857;","class InteractionManager {\n  constructor(engine) {\n    this.engine = engine;\n    this._behaviors = {};\n    this._events = [\n      'click', 'dblclick', 'mousedown', 'mouseup', 'mouseover', 'mouseout',\n      'mousemove', 'contextmenu', 'wheel'\n    ];\n  }\n\n  add(behavior, name) {\n    this._behaviors[name] = behavior;\n    // By default, behaviors are not enabled until explicitly told to do so.\n  }\n\n  enable(name) {\n    const behavior = this._behaviors[name];\n    if (behavior) {\n      behavior.enable();\n    }\n  }\n\n  disable(name) {\n    const behavior = this._behaviors[name];\n    if (behavior) {\n      behavior.disable();\n    }\n  }\n\n  _initEvents() {\n    const container = this.engine.container;\n    for (const event of this._events) {\n      container.addEventListener(event, this._handleEvent.bind(this));\n    }\n  }\n\n  _handleEvent(e) {\n    // This is a simplified event delegation model.\n    // A more robust implementation might involve a priority system for behaviors.\n    for (const name in this._behaviors) {\n      const behavior = this._behaviors[name];\n      if (behavior.enabled()) {\n        // Pass the event to the behavior's event handler, if it exists.\n        const handler = behavior[e.type];\n        if (handler && typeof handler === 'function') {\n          handler.call(behavior, e);\n        }\n      }\n    }\n  }\n}\n\nexport default InteractionManager;","/**\n * The base class for all user interaction handlers (behaviors) in Atlas.js.\n * It provides a standard interface for enabling and disabling interactions.\n */\nclass Behavior {\n  constructor(engine) {\n    this.engine = engine;\n    this._enabled = false;\n  }\n\n  /**\n   * Enables the behavior. This method should be implemented by subclasses\n   * to add the necessary event listeners.\n   */\n  enable() {\n    if (this._enabled) { return; }\n    this._enabled = true;\n    this.addHooks();\n  }\n\n  /**\n   * Disables the behavior. This method should be implemented by subclasses\n   * to remove the event listeners.\n   */\n  disable() {\n    if (!this._enabled) { return; }\n    this._enabled = false;\n    this.removeHooks();\n  }\n\n  /**\n   * Returns true if the behavior is currently enabled.\n   * @returns {boolean}\n   */\n  enabled() {\n    return this._enabled;\n  }\n\n  /**\n   * Placeholder method for adding event listeners.\n   * Must be implemented by subclasses.\n   */\n  addHooks() {\n    throw new Error('The addHooks() method must be implemented by subclasses.');\n  }\n\n  /**\n   * Placeholder method for removing event listeners.\n   * Must be implemented by subclasses.\n   */\n  removeHooks() {\n    throw new Error('The removeHooks() method must be implemented by subclasses.');\n  }\n}\n\nexport default Behavior;","import Behavior from './Behavior.js';\n\nclass DragPan extends Behavior {\n  constructor(engine) {\n    super(engine);\n    this._isDragging = false;\n    this._lastPos = null;\n  }\n\n  addHooks() {\n    this.engine.container.addEventListener('mousedown', this._onMouseDown.bind(this));\n    this.engine.container.addEventListener('mouseup', this._onMouseUp.bind(this));\n    this.engine.container.addEventListener('mousemove', this._onMouseMove.bind(this));\n  }\n\n  removeHooks() {\n    this.engine.container.removeEventListener('mousedown', this._onMouseDown.bind(this));\n    this.engine.container.removeEventListener('mouseup', this._onMouseUp.bind(this));\n    this.engine.container.removeEventListener('mousemove', this._onMouseMove.bind(this));\n  }\n\n  _onMouseDown(e) {\n    if (e.button !== 0) { return; } // Only handle left-clicks\n    this._isDragging = true;\n    this._lastPos = { x: e.clientX, y: e.clientY };\n    this.engine.container.style.cursor = 'grabbing';\n  }\n\n  _onMouseUp() {\n    this._isDragging = false;\n    this.engine.container.style.cursor = 'grab';\n  }\n\n  _onMouseMove(e) {\n    if (!this._isDragging) { return; }\n\n    const pos = { x: e.clientX, y: e.clientY };\n    const offset = {\n      x: this._lastPos.x - pos.x,\n      y: this._lastPos.y - pos.y\n    };\n\n    this.engine.viewport.panBy(offset);\n    this._lastPos = pos;\n  }\n}\n\nexport default DragPan;","import Behavior from './Behavior.js';\n\nclass ScrollWheelZoom extends Behavior {\n  addHooks() {\n    this.engine.container.addEventListener('wheel', this._onWheel.bind(this));\n  }\n\n  removeHooks() {\n    this.engine.container.removeEventListener('wheel', this._onWheel.bind(this));\n  }\n\n  _onWheel(e) {\n    e.preventDefault();\n\n    const delta = e.deltaY;\n    if (delta > 0) {\n      this.engine.viewport.zoomOut();\n    } else if (delta < 0) {\n      this.engine.viewport.zoomIn();\n    }\n  }\n}\n\nexport default ScrollWheelZoom;","class WidgetSystem {\n  constructor(engine) {\n    this.engine = engine;\n    this._widgets = [];\n    this._corners = {};\n    this._initLayout();\n  }\n\n  add(widget) {\n    this._widgets.push(widget);\n    widget._container = widget.onAdd(this.engine);\n\n    const pos = widget.options.position || 'topright';\n    const corner = this._corners[pos];\n\n    if (corner) {\n      if (pos.includes('bottom')) {\n        corner.insertBefore(widget.getContainer(), corner.firstChild);\n      } else {\n        corner.appendChild(widget.getContainer());\n      }\n    }\n    return this;\n  }\n\n  remove(widget) {\n    const index = this._widgets.indexOf(widget);\n    if (index > -1) {\n      this._widgets.splice(index, 1);\n\n      const container = widget.getContainer();\n      if (container && container.parentNode) {\n        container.parentNode.removeChild(container);\n      }\n\n      if (widget.onRemove) {\n        widget.onRemove(this.engine);\n      }\n    }\n    return this;\n  }\n\n  _initLayout() {\n    const container = this.engine.container;\n\n    this._controlContainer = document.createElement('div');\n    this._controlContainer.className = 'atlas-widget-container';\n    container.appendChild(this._controlContainer);\n\n    this._createCorner('top', 'left');\n    this._createCorner('top', 'right');\n    this._createCorner('bottom', 'left');\n    this._createCorner('bottom', 'right');\n  }\n\n  _createCorner(vSide, hSide) {\n    const className = `atlas-widget-${vSide} atlas-widget-${hSide}`;\n    const corner = document.createElement('div');\n    corner.className = className;\n    this._corners[vSide + hSide] = corner;\n    this._controlContainer.appendChild(corner);\n  }\n}\n\nexport default WidgetSystem;","/**\n * The base class for all UI components (widgets) in Atlas.js.\n * It provides a standard interface for widgets to be added to and removed from the map.\n */\nclass Widget {\n  constructor(engine, options = {}) {\n    this.engine = engine;\n    this.options = { ...options };\n    this._container = null;\n  }\n\n  /**\n   * Called when the widget is added to the map by the WidgetSystem.\n   * This method must be implemented by subclasses and should return the widget's DOM container.\n   * @param {AtlasEngine} engine - The main engine instance.\n   * @returns {HTMLElement} The widget's container element.\n   */\n  onAdd(engine) {\n    throw new Error('The onAdd() method must be implemented by subclasses.');\n  }\n\n  /**\n   * Called when the widget is removed from the map.\n   * Subclasses can implement this method to perform any necessary cleanup.\n   * @param {AtlasEngine} engine - The main engine instance.\n   */\n  onRemove(engine) {\n    // Optional: To be implemented by subclasses for cleanup logic.\n  }\n\n  /**\n   * Returns the widget's main DOM container.\n   * @returns {HTMLElement} The container element.\n   */\n  getContainer() {\n    return this._container;\n  }\n}\n\nexport default Widget;","import Widget from './Widget.js';\n\nclass ZoomWidget extends Widget {\n  constructor(engine, options) {\n    super(engine, {\n      position: 'topleft',\n      zoomInText: '+',\n      zoomInTitle: 'Zoom in',\n      zoomOutText: '−',\n      zoomOutTitle: 'Zoom out',\n      ...options\n    });\n  }\n\n  onAdd(engine) {\n    const container = document.createElement('div');\n    container.className = 'atlas-zoom-widget atlas-bar';\n\n    this._zoomInButton = this._createButton(this.options.zoomInText, this.options.zoomInTitle, 'atlas-zoom-in', container, () => this.engine.viewport.zoomIn());\n    this._zoomOutButton = this._createButton(this.options.zoomOutText, this.options.zoomOutTitle, 'atlas-zoom-out', container, () => this.engine.viewport.zoomOut());\n\n    this.engine.stateManager.watch('viewport.zoom', () => this._updateDisabled());\n    this._updateDisabled();\n\n    return container;\n  }\n\n  _createButton(html, title, className, container, fn) {\n    const link = document.createElement('a');\n    link.innerHTML = html;\n    link.href = '#';\n    link.title = title;\n    link.className = className;\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-label', title);\n\n    link.addEventListener('click', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      fn();\n    });\n\n    container.appendChild(link);\n    return link;\n  }\n\n  _updateDisabled() {\n    const zoom = this.engine.stateManager.get('viewport.zoom');\n    const minZoom = this.engine.stateManager.get('viewport.minZoom') || 0;\n    const maxZoom = this.engine.stateManager.get('viewport.maxZoom') || 18;\n\n    this._zoomInButton.classList.remove('atlas-disabled');\n    this._zoomOutButton.classList.remove('atlas-disabled');\n\n    if (zoom <= minZoom) {\n      this._zoomOutButton.classList.add('atlas-disabled');\n    }\n    if (zoom >= maxZoom) {\n      this._zoomInButton.classList.add('atlas-disabled');\n    }\n  }\n}\n\nexport default ZoomWidget;","import StateManager from '../state/StateManager.js';\nimport CommandBus from '../commands/CommandBus.js';\nimport ViewportManager from '../viewport/ViewportManager.js';\nimport SurfaceManager from '../surfaces/SurfaceManager.js';\nimport RenderPipeline from '../rendering/RenderPipeline.js';\nimport EPSG3857 from '../projection/EPSG3857.js';\nimport InteractionManager from '../interaction/InteractionManager.js';\nimport DragPan from '../interaction/DragPan.js';\nimport ScrollWheelZoom from '../interaction/ScrollWheelZoom.js';\nimport WidgetSystem from '../widgets/WidgetSystem.js';\nimport ZoomWidget from '../widgets/ZoomWidget.js';\n\nclass AtlasEngine {\n  constructor(containerId, options = {}) {\n    this.container = document.getElementById(containerId);\n    if (!this.container) {\n      throw new Error(`Container with id \"${containerId}\" not found.`);\n    }\n\n    // Initialize core components\n    this.stateManager = new StateManager();\n    this.commandBus = new CommandBus();\n    this.projection = options.projection || new EPSG3857();\n    this.viewport = new ViewportManager(this, options);\n    this.surfaces = new SurfaceManager(this);\n    this.renderPipeline = new RenderPipeline(this);\n    this.widgets = new WidgetSystem(this);\n    this.interaction = new InteractionManager(this);\n\n    // Add default widgets and behaviors\n    this.widgets.add(new ZoomWidget(this));\n    this.interaction.add(new DragPan(this), 'dragPan');\n    this.interaction.add(new ScrollWheelZoom(this), 'scrollWheelZoom');\n\n    // Enable default behaviors\n    this.interaction.enable('dragPan');\n    this.interaction.enable('scrollWheelZoom');\n\n    this.interaction._initEvents();\n  }\n}\n\nexport default AtlasEngine;","class Surface {\n  constructor(engine) {\n    this.engine = engine;\n  }\n\n  onMount() {\n    // Optional: To be implemented by subclasses for setup logic\n  }\n\n  onUnmount() {\n    // Optional: To be implemented by subclasses for teardown logic\n  }\n\n  render(renderer) {\n    // This method must be implemented by subclasses\n    throw new Error('The render() method must be implemented by subclasses.');\n  }\n}\n\nexport default Surface;","class Feature {\n  constructor(geometry, properties = {}, style = {}) {\n    this.geometry = geometry;\n    this.properties = properties;\n    this.style = {\n      color: 'blue',\n      weight: 3,\n      fillColor: 'blue',\n      fillOpacity: 0.2,\n      ...style\n    };\n  }\n}\n\nexport default Feature;","import Surface from './Surface.js';\n\nclass TileSurface extends Surface {\n  constructor(engine, options) {\n    super(engine);\n    this.options = {\n      tileSize: 256,\n      subdomains: 'abc',\n      minZoom: 0,\n      maxZoom: 18,\n      ...options,\n    };\n    this._tiles = {};\n\n    // Watch for changes in the viewport to trigger re-renders\n    this.engine.stateManager.watch('viewport.center', () => this.engine.renderPipeline.render());\n    this.engine.stateManager.watch('viewport.zoom', () => this.engine.renderPipeline.render());\n  }\n\n  _getTileUrl(coords) {\n    const data = {\n      x: coords.x,\n      y: coords.y,\n      z: coords.z,\n      s: this.options.subdomains[Math.floor(Math.random() * this.options.subdomains.length)],\n    };\n    return this.options.urlTemplate.replace(/\\{(\\w+)\\}/g, (match, key) => data[key]);\n  }\n\n  render(renderer) {\n    const zoom = Math.round(this.engine.stateManager.get('viewport.zoom'));\n    if (zoom < this.options.minZoom || zoom > this.options.maxZoom || !this.options.urlTemplate) {\n      return;\n    }\n\n    const center = this.engine.stateManager.get('viewport.center');\n    const projection = this.engine.projection;\n    const scale = projection.scale(zoom);\n    const tileSize = this.options.tileSize;\n\n    const pixelOrigin = this.engine.viewport.getPixelOrigin();\n    const mapSize = this.engine.viewport.getSize();\n\n    const tileRange = this._getTileRange(pixelOrigin, mapSize, tileSize);\n\n    for (let j = tileRange.min.y; j <= tileRange.max.y; j++) {\n      for (let i = tileRange.min.x; i <= tileRange.max.x; i++) {\n        const tileCoords = { x: i, y: j, z: zoom };\n        const tileId = `${tileCoords.x}:${tileCoords.y}:${tileCoords.z}`;\n\n        if (!this._tiles[tileId]) {\n          this._createTile(tileCoords);\n        }\n\n        if (this._tiles[tileId] && this._tiles[tileId].complete && this._tiles[tileId].naturalWidth !== 0) {\n          const tile = this._tiles[tileId];\n          const tilePos = this._getTilePos(tileCoords, pixelOrigin, tileSize);\n          renderer.drawImage(tile, tilePos.x, tilePos.y, tileSize, tileSize);\n        }\n      }\n    }\n  }\n\n  _getTilePos(coords, pixelOrigin, tileSize) {\n    const x = (coords.x * tileSize) - pixelOrigin.x;\n    const y = (coords.y * tileSize) - pixelOrigin.y;\n    return {x, y};\n  }\n\n  _getTileRange(pixelOrigin, mapSize, tileSize) {\n      const min = pixelOrigin.divideBy(tileSize).floor();\n      const max = pixelOrigin.add(mapSize).divideBy(tileSize).floor();\n      return {min, max};\n  }\n\n  _createTile(coords) {\n    const tileId = `${coords.x}:${coords.y}:${coords.z}`;\n    if (this._tiles[tileId]) {\n      return;\n    }\n\n    const tile = new Image();\n    tile.crossOrigin = 'Anonymous';\n    this._tiles[tileId] = tile;\n\n    tile.onload = () => {\n      this.engine.renderPipeline.render();\n    };\n\n    tile.onerror = () => {\n      console.error(`Failed to load tile: ${tile.src}`);\n    };\n\n    tile.src = this._getTileUrl(coords);\n  }\n}\n\nexport default TileSurface;","import Surface from './Surface.js';\n\nclass VectorSurface extends Surface {\n  constructor(engine, features = []) {\n    super(engine);\n    this.features = features;\n\n    // Watch for changes in the viewport to trigger re-renders\n    this.engine.stateManager.watch('viewport.center', () => this.engine.renderPipeline.render());\n    this.engine.stateManager.watch('viewport.zoom', () => this.engine.renderPipeline.render());\n  }\n\n  addFeature(feature) {\n    this.features.push(feature);\n    this.engine.renderPipeline.render();\n  }\n\n  removeFeature(feature) {\n    const index = this.features.indexOf(feature);\n    if (index > -1) {\n      this.features.splice(index, 1);\n      this.engine.renderPipeline.render();\n    }\n  }\n\n  render(renderer) {\n    for (const feature of this.features) {\n      this.engine.renderPipeline.draw(renderer, feature);\n    }\n  }\n}\n\nexport default VectorSurface;"],"names":["StateManager","constructor","this","state","listeners","set","key","value","forEach","listener","get","watch","push","unwatch","filter","l","CommandBus","handlers","register","commandName","handler","execute","payload","Error","formatNum","num","precision","pow","Math","undefined","round","isArray","Array","obj","Object","prototype","toString","call","LineUtil","clip","points","bounds","PolygonUtil","Area","corner1","corner2","point","extend","sw2","ne2","GeoPoint","toGeoPoint","toArea","_southWest","_northEast","lat","min","lng","max","pad","bufferRatio","sw","ne","heightBuffer","abs","widthBuffer","getCenter","getSouthWest","getNorthEast","getNorthWest","getNorth","getWest","getSouthEast","getSouth","getEast","contains","intersects","otherArea","latIntersects","lngIntersects","toBBoxString","join","equals","maxMargin","isValid","a","b","alt","isNaN","other","distanceTo","rad","PI","lat1","lat2","sinDLat","sin","sinDLon","cos","atan2","sqrt","sizeInMeters","latAccuracy","lngAccuracy","clone","c","length","lon","trunc","v","floor","ceil","PixelPoint","x","y","add","newPoint","subtract","divideBy","multiplyBy","scaleBy","unscaleBy","ViewportManager","engine","options","stateManager","center","zoom","navigateTo","zoomIn","delta","currentZoom","zoomOut","panBy","offset","projection","newPixel","projectToPixel","newCenter","unprojectFromPixel","getPixelOrigin","pixelPoint","viewHalf","getSize","container","clientWidth","clientHeight","getPixelBounds","size","SurfaceManager","surfaces","mount","surface","onMount","renderPipeline","render","unmount","index","indexOf","onUnmount","splice","GeoLine","GeoPolygon","RenderPipeline","renderer","_initRenderer","canvas","document","createElement","appendChild","getContext","_onResize","bind","width","height","clearRect","draw","feature","pixelOrigin","viewport","strokeStyle","style","color","lineWidth","weight","fillStyle","fillColor","globalAlpha","fillOpacity","geometry","_drawPoint","_drawLine","_drawPolygon","_toPixelPoints","map","p","beginPath","arc","fill","stroke","clippedPoints","i","moveTo","lineTo","closePath","R","Mercator","MAX_LATITUDE","d","project","geoPoint","log","unproject","atan","exp","Transformation","_a","_b","_c","_d","transform","scale","untransform","EPSG3857","code","transformation","projectedPoint","untransformedPoint","LN2","InteractionManager","_behaviors","_events","behavior","name","enable","disable","_initEvents","event","addEventListener","_handleEvent","e","enabled","type","Behavior","_enabled","addHooks","removeHooks","DragPan","super","_isDragging","_lastPos","_onMouseDown","_onMouseUp","_onMouseMove","removeEventListener","button","clientX","clientY","cursor","pos","ScrollWheelZoom","_onWheel","preventDefault","deltaY","WidgetSystem","_widgets","_corners","_initLayout","widget","_container","onAdd","position","corner","includes","insertBefore","getContainer","firstChild","remove","parentNode","removeChild","onRemove","_controlContainer","className","_createCorner","vSide","hSide","Widget","ZoomWidget","zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","_zoomInButton","_createButton","_zoomOutButton","_updateDisabled","html","title","fn","link","innerHTML","href","setAttribute","stopPropagation","minZoom","maxZoom","classList","AtlasEngine","containerId","getElementById","commandBus","widgets","interaction","Surface","properties","tileSize","subdomains","_tiles","_getTileUrl","coords","data","z","s","random","urlTemplate","replace","match","mapSize","tileRange","_getTileRange","j","tileCoords","tileId","_createTile","complete","naturalWidth","tile","tilePos","_getTilePos","drawImage","Image","crossOrigin","onload","onerror","console","error","src","features","addFeature","removeFeature"],"mappings":"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"}